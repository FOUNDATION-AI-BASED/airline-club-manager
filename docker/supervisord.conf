[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
logfile_maxbytes=10MB
logfile_backups=2
loglevel=error
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[program:mariadb]
command=/usr/bin/mysqld_safe
user=mysql
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/mariadb.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=2
stdout_capture_maxbytes=1MB
stdout_events_enabled=false
stderr_logfile=/var/log/supervisor/mariadb_error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=2
stderr_capture_maxbytes=1MB
stderr_events_enabled=false
priority=100

[program:airline-web]
command=/bin/bash -c 'cd /app/airline/airline-web && sbt -Dhttp.port=9000 -Dhttp.address=0.0.0.0 run'
environment=SBT_OPTS="-Xms512m -Xmx2048m -XX:MaxMetaspaceSize=256m -XX:+UseG1GC -Dsbt.log.noformat=true",JAVA_OPTS="-Xms512m -Xmx2048m -XX:MaxMetaspaceSize=256m -XX:+UseG1GC"
user=root
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/web.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=3
stderr_logfile=/app/logs/web_error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=3
priority=200
startretries=3
startsecs=30

[program:airline-simulation]
command=/bin/bash -c 'cd /app/airline/airline-data && sbt "runMain com.patson.MainSimulation"'
environment=SBT_OPTS="-Xms256m -Xmx1536m -XX:MaxMetaspaceSize=256m -XX:+UseG1GC -Dsbt.log.noformat=true",JAVA_OPTS="-Xms256m -Xmx1536m -XX:MaxMetaspaceSize=256m -XX:+UseG1GC"
user=root
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/simulation.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=3
stderr_logfile=/app/logs/simulation_error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=3
priority=300
startretries=3
startsecs=30

[group:airline-services]
programs=airline-web,airline-simulation
priority=999

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface